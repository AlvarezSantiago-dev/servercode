<form id="add-to-cart-form" method="POST">
    <div class="d-flex justify-content-center ">
        {{#if product._id}}
        <div class="card p-3" style="width: 30rem; ">
            <img src={{product.photo}} class="card-img-top" alt="...">
            <div class="card-body bg-secondary m-2">
                <h5 class="card-title">{{product.title}}</h5>
                <span class="text-white">Category: {{product.category}}</span>
                <br>
                <p class="text-danger p-1">Stock: {{product.stock}}</p>
                <p class="card-text m-1">Some quick example text to build on the card title and make up the bulk of the
                    card's
                    content.</p>
                <span class="float-end text-white">Price: ${{product.price}}</span>
                <input type="hidden" value="{{product._id}}" name="product_id">
                <button class="btn btn-success m-2" id="addcart" type="submit">ADD TO CART</button>
            </div>
        {{else}}
            <h1>PRODUCT NOT FOUND</h1>
        {{/if}}
        <a href="/products/paginate?page=1&limit=10" class="btn btn-danger m-1">Volver</a>
    </div>
</form>

<script>
    document.getElementById('add-to-cart-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        const form = event.target;
        const productId = form.product_id.value;

        try {
            const response = await fetch("http://localhost:8080/api/carts", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ product_id: productId })
            });
            if (response.ok) {
                const result = await response.json();
                alert(result.message);
            } else {
                const error = await response.json();
                alert(error.message || 'An error occurred while adding the product to the cart.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An unexpected error occurred.');
        }
    });
</script>
